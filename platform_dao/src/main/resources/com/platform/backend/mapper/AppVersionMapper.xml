<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.backend.mapper.AppVersionMapper">

    <resultMap id="AppVersionResultMap" type="appVersion">
        <id property="id" column="id" jdbcType="BIGINT"/>
        <result property="appId" column="appId" jdbcType="BIGINT"/>
        <result property="versionNo" column="versionNo" jdbcType="VARCHAR"/>
        <result property="versionInfo" column="versionInfo" jdbcType="VARCHAR"/>
        <result property="publishStatus" column="publishStatus" jdbcType="BIGINT"/>
        <result property="downloadLink" column="downloadLink" jdbcType="VARCHAR"/>
        <result property="versionSize" column="versionSize" jdbcType="DECIMAL"/>
        <result property="createdBy" column="createdBy" jdbcType="BIGINT"/>
        <result property="creationDate" column="creationDate" jdbcType="TIMESTAMP"/>
        <result property="modifyBy" column="modifyBy" jdbcType="BIGINT"/>
        <result property="modifyDate" column="modifyDate" jdbcType="TIMESTAMP"/>
        <result property="apkLocPath" column="apkLocPath" jdbcType="VARCHAR"/>
        <result property="apkFileName" column="apkFileName" jdbcType="VARCHAR"/>
    </resultMap>

    <sql id="AppVersion_Column_List">
        id,appId,versionNo,
        versionInfo,publishStatus,downloadLink,
        versionSize,createdBy,creationDate,
        modifyBy,modifyDate,apkLocPath,
        apkFileName
    </sql>


    <select id="selectAppVersionByVersionId" resultMap="AppVersionResultMap" parameterType="long">
        select
        <include refid="AppVersion_Column_List"/>
        from t_app_version where id=#{versionId};
    </select>

    <update id="updateAppVersionByAppId" parameterType="map">
        update t_app_version ver
        <set>
            <if test="appVersion.versionInfo!=null and appVersion.versionInfo!=''">
                ver.versionInfo =#{appVersion.versionInfo},
            </if>
            <if test="appVersion.versionSize!=null and appVersion.versionSize!=''">
                ver.versionSize = #{appVersion.versionSize}
            </if>
        </set>
        <where>
            <if test="appVersion.appId!=null and appVersion.appId!=''">
                ver.appId = #{appVersion.appId};
            </if>
        </where>
    </update>
    <insert id="insertAppVersion" parameterType="appVersion">
        insert into t_app_version (id, appId, versionNo, versionInfo, publishStatus, downloadLink, versionSize,
                                   createdBy,
                                   creationDate, modifyBy, modifyDate, apkLocPath, apkFileName)
        values (null, #{appVersion.appId}, #{appVersion.versionNo}, #{appVersion.versionInfo},
                #{appVersion.publishStatus},
                #{appVersion.downloadLink}, #{appVersion.versionSize}, #{appVersion.createdBy},
                #{appVersion.creationDate}, #{appVersion.modifyBy}, #{appVersion.modifyDate},
                #{appVersion.apkLocPath}, #{appVersion.apkFileName});
    </insert>
    <select id="selectAppVersionByAppId" resultMap="AppVersionResultMap" parameterType="long">
        select
        <include refid="AppVersion_Column_List"/>
        from t_app_version where appId=#{appId};
    </select>
    <update id="deleteApk" parameterType="long">
        update t_app_version
        set apkLocPath = null,
            apkFileName=null
        where appId = #{appId};
    </update>
</mapper>
